<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Borderlands Farm Tracker</title>

    <!-- PWA -->
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#212529" />

    <!-- iOS support -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <link rel="apple-touch-icon" href="icons/icon-180-ios.png" />
    <link rel="icon" type="image/png" sizes="64x64" href="icons/icon-64.png">

    <!-- Bootstrap CDN -->
    <link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
        rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</head>

<body class="bg-dark text-light">

<div class="container py-4">
    <h1 class="mb-4 text-center">Borderlands – Farm Tracker</h1>

    <div id="iosInstallBanner" class="alert alert-info alert-dismissible fade show d-none" role="alert">
        <strong>Zainstaluj aplikację:</strong> Stuknij w <strong>Udostępnij</strong> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-share d-inline" viewBox="0 0 16 16"><path d="M13.5 1a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3M11 2.5a2.5 2.5 0 1 1 .603 1.628l-6.718 3.12a2.5 2.5 0 0 1 0 1.504l6.718 3.12a2.5 2.5 0 1 1-.488.876l-6.718-3.12a2.5 2.5 0 1 1 0-3.256l6.718-3.12A2.5 2.5 0 0 1 11 2.5m-8.5 4a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3m11 5.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3"/></svg>, a następnie wybierz <strong>Dodaj do ekranu głównego</strong>.
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>

    <div class="table-responsive">
        <table class="table table-dark table-striped align-middle text-center">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Count</th>
                    <th>Increment</th>
                </tr>
            </thead>
            <tbody id="itemsTable"></tbody>
        </table>
    </div>
</div>

<script>
const STORAGE_KEY = "borderlands_farm_items";

const defaultItems = [
    { name: "Oil can", current: 0, required: 25 },
    { name: "Bubblehead", current: 0, required: 15 },
    { name: "Panties", current: 0, required: 3 },
    { name: "Fish", current: 0, required: 5 },
    { name: "Pizza", current: 0, required: 15 }
];

function loadItems() {
    const saved = localStorage.getItem(STORAGE_KEY);
    return saved ? JSON.parse(saved) : defaultItems;
}

function saveItems(items) {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(items));
}

function renderTable() {
    const tbody = document.getElementById("itemsTable");
    tbody.innerHTML = "";

    items.forEach((item, index) => {
        const completed = item.current >= item.required;

        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td>${item.name}</td>
            <td>
                <span class="${completed ? "text-success fw-bold" : ""}">
                    ${item.current} / ${item.required}
                </span>
            </td>
            <td>
                <button class="btn btn-lg btn-success"
                    onclick="increment(${index})"
                    ${completed ? "disabled" : ""}>
                    +
                </button>
            </td>
        `;
        tbody.appendChild(tr);
    });
}

function increment(index) {
    items[index].current++;
    saveItems(items);
    renderTable();
}

let items = loadItems();
renderTable();

function isIOS() {
    return /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
}

function isStandalone() {
    return window.navigator.standalone === true || window.matchMedia('(display-mode: standalone)').matches;
}

if (isIOS() && !isStandalone()) {
    const banner = document.getElementById('iosInstallBanner');
    if (banner) {
        banner.classList.remove('d-none');
    }
}

// Register Service Worker
if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
        navigator.serviceWorker.register("service-worker.js");
    });
}
</script>

</body>
</html>
